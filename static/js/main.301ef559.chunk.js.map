{"version":3,"sources":["utils/index.ts","utils/http.ts","utils/use-async.ts","components/profiler.tsx","components/error-boundary.tsx","App.tsx","reportWebVitals.ts","context/index.tsx","index.tsx","auth-provider.ts","components/lib.tsx","context/auth-context.tsx"],"names":["cleanObject","object","result","Object","keys","forEach","key","value","undefined","isVoid","useMount","callback","useEffect","useDebounce","delay","useState","debouncedValue","setDebouncedValue","timeout","setTimeout","clearTimeout","useDocumentTitle","title","keepOnUnment","oldTitle","useRef","document","current","resetRoute","window","location","href","origin","subset","obj","filteredEntries","entries","filter","includes","fromEntries","useMountedRef","mountedRef","apiUrl","process","http","endpoint","a","data","token","headers","customConfig","config","method","Authorization","toUpperCase","qs","stringify","addQueryPrefix","body","JSON","fetch","then","response","status","auth","reload","Promise","reject","message","json","ok","useHttp","user","useAuth","useCallback","defultInitialState","stat","error","defaultConfig","throwOnError","useAsync","initialState","initiaConfig","useReducer","state","action","safeDispatch","dispatch","useSafeDispatch","retry","setRetry","setData","setError","run","promise","runConfig","Error","catch","isiIdle","isLoading","isError","isSuccess","queue","setInterval","length","queueToSend","console","log","Profiler","metadata","phases","props","onRender","id","phase","actualDuration","baseDuration","startTime","commitTime","interactions","push","ErrorBoundary","this","fallbackRender","children","React","Component","AuthenticatedApp","lazy","UnauthenticatedApp","App","className","FullPageErrorFallback","Suspense","fallback","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","AuthProviders","queryClient","QueryClient","defaultOptions","queries","refetchOnWindowFocus","client","loadServer","ReactDOM","render","StrictMode","getElementById","localStorageKey","getToken","localStorage","getItem","handleUserResponse","setItem","login","register","logout","removeItem","ButtonNoPadding","styled","Button","FullPageLoading","FullPage","size","ErrorBox","Text","type","div","Row","between","marginBottom","gap","ScreenContainer","bootstrapUser","AuthContext","createContext","displayName","AuthProvider","setUser","useQueryClient","Provider","form","clear","context","useContext"],"mappings":"uYAaaA,EAAc,SAACC,GAC1B,IAAKA,EAAQ,MAAO,GACpB,IAAMC,EAAM,eAAQD,GAOpB,OANAE,OAAOC,KAAKF,GAAQG,SAAQ,SAACC,IALT,SAACC,GAAD,YAA8BC,IAAVD,GAAiC,OAAVA,GAA4B,KAAVA,GAO3EE,CADUP,EAAOI,YAEZJ,EAAOI,MAGXJ,GAGIQ,EAAW,SAACC,GACvBC,qBAAU,WACRD,MACC,CAACA,KAGOE,EAAc,SAAIN,EAAUO,GAAoB,IAAD,EACdC,mBAAYR,GADE,mBACnDS,EADmD,KACnCC,EADmC,KAU1D,OAPAL,qBAAU,WACR,IAAMM,EAAUC,YAAW,WACzBF,EAAkBV,KACjBO,GACH,OAAO,kBAAMM,aAAaF,MACzB,CAACX,EAAOO,IAEJE,GAmBIK,EAAmB,SAACC,GAAiD,IAAlCC,IAAiC,yDACzEC,EAAWC,iBAAOC,SAASJ,OAAOK,QAExCf,qBAAU,WACRc,SAASJ,MAAQA,IAChB,CAACA,IAEJV,qBAAU,WACR,OAAO,WACAW,IACHG,SAASJ,MAAQE,MAGpB,CAACD,EAAcC,KAGPI,EAAa,kBAAOC,OAAOC,SAASC,KAAOF,OAAOC,SAASE,QAO3DC,EAAS,SAA4DC,EAAQ9B,GACxF,IAAM+B,EAAkBhC,OAAOiC,QAAQF,GAAKG,QAAO,gBAAE/B,EAAF,2BAAWF,EAAKkC,SAAShC,MAC5E,OAAOH,OAAOoC,YAAYJ,IAMfK,EAAgB,WAC3B,IAAMC,EAAahB,kBAAO,GAO1B,OANAb,qBAAU,WAER,OADA6B,EAAWd,SAAU,EACd,WACLc,EAAWd,SAAU,MAGlBc,I,4LChFHC,EAASC,qBAEFC,EAAI,uCAAG,WAAOC,GAAP,mCAAAC,EAAA,8FAA6E,GAAlDC,EAA3B,EAA2BA,KAAMC,EAAjC,EAAiCA,MAAjC,EAAwCC,QAAYC,EAApD,0CAUkB,SAT9BC,EADY,aAEhBC,OAAQ,MACRH,QAAS,CACPI,cAAeL,EAAK,iBAAaA,GAAU,GAC3C,eAAgBD,EAAO,mBAAqB,KAE3CG,IAGME,OAAOE,cAChBT,GAAYU,IAAGC,UAAH,OAAaT,QAAb,IAAaA,IAAQ,GAAI,CAAEU,gBAAgB,IAEvDN,EAAOO,KAAOC,KAAKH,UAAUT,GAbb,kBAiBXlB,OAAO+B,MAAP,UAAgBlB,EAAhB,YAA0BG,GAAYM,GAAQU,KAA9C,uCAAmD,WAAMC,GAAN,eAAAhB,EAAA,yDAChC,MAApBgB,EAASC,OAD2C,gCAEhDC,MAFgD,cAGtDnC,OAAOC,SAASmC,SAHsC,kBAI/CC,QAAQC,OAAO,CAAEC,QAAS,oCAJqB,uBAMrCN,EAASO,OAN4B,UAMlDtB,EANkD,QAOpDe,EAASQ,GAP2C,0CAQ/CvB,GAR+C,iCAU/CmB,QAAQC,OAAOpB,IAVgC,4CAAnD,wDAjBW,2CAAH,sDAgCJwB,EAAU,WAAO,IACpBC,EAASC,cAATD,KAER,OAAOE,uBACL,uFAAK7B,EAAL,KAAeM,EAAf,YAAoDP,EAAKC,EAAD,YAAC,eAAeM,GAAhB,IAAwBH,MAAK,OAAEwB,QAAF,IAAEA,OAAF,EAAEA,EAAMxB,WAC7F,QAACwB,QAAD,IAACA,OAAD,EAACA,EAAMxB,U,uGCzCL2B,EAAkC,CACtCC,KAAM,OACN7B,KAAM,KACN8B,MAAO,MAGHC,EAAgB,CACpBC,cAAc,GAQHC,EAAW,SAAIC,EAAyBC,GACnD,IAAM/B,EAAM,2BAAQ2B,GAAkBI,GADqD,EAEjEC,sBAAW,SAACC,EAAiBC,GAAlB,mBAAC,eAAqDD,GAAUC,KAAjE,YAAC,eAChCV,GACAM,IAJsF,mBAEpFG,EAFoF,KAMrFE,EAXgB,SAAIC,GAC1B,IAAM9C,EAAaD,cACnB,OAAOkC,uBAAY,kBAAmBjC,EAAWd,QAAU4D,EAAQ,WAAR,kBAAoB,IAAS,CAACA,EAAU9C,IAS9E+C,CANsE,QAQjEzE,oBAAS,kBAAM,gBARkD,mBAQpF0E,EARoF,KAQ7EC,EAR6E,KAUrFC,EAAUjB,uBACd,SAAC3B,GAAD,OACEuC,EAAa,CACXvC,OACA6B,KAAM,UACNC,MAAO,SAEX,CAACS,IAGGM,EAAWlB,uBACf,SAACG,GAAD,OACES,EAAa,CACXT,QACAD,KAAM,QACN7B,KAAM,SAEV,CAACuC,IAGGO,EAAMnB,uBACV,SAACoB,EAAqBC,GACpB,IAAKD,IAAYA,EAAQjC,KACvB,MAAM,IAAImC,MAAM,uDAQlB,OANAN,GAAS,kBAAM,YACb,OAAIK,QAAJ,IAAIA,OAAJ,EAAIA,EAAWN,QACbI,EAAG,OAACE,QAAD,IAACA,OAAD,EAACA,EAAWN,QAASM,OAG5BT,EAAa,CAAEV,KAAM,YACdkB,EACJjC,MAAK,SAAAd,GAEJ,OADA4C,EAAQ5C,GACDA,KAERkD,OAAM,SAAApB,GAGL,OADAe,EAASf,GACL1B,EAAO4B,aAAqBb,QAAQC,OAAOU,GACxCA,OAGb,CAAC1B,EAAO4B,aAAcY,EAASC,EAAUN,IAE3C,OAAO,aACLY,QAAwB,SAAfd,EAAMR,KACfuB,UAA0B,YAAff,EAAMR,KACjBwB,QAAwB,UAAfhB,EAAMR,KACfyB,UAA0B,YAAfjB,EAAMR,KACjBiB,MACAJ,QACAE,UACAC,YACGR,K,wGC5FHkB,EAAmB,GAWvBC,aATyB,WACvB,GAAKD,EAAME,OAAX,CAGA,IAAMC,EAAW,YAAOH,GACxBA,EAAQ,GACRI,QAAQC,IAAI,2BAAQF,MAGQ,KAEvB,IAAMG,EAAW,SAAC,GAA2C,IAAzCC,EAAwC,EAAxCA,SAAUC,EAA8B,EAA9BA,OAAWC,EAAmB,qCAwBjE,OAAO,kBAAC,IAAMH,SAAP,eAAgBI,SAvByB,SAC9CC,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,GAEKT,IAAUA,EAAOxE,SAAS4E,IAC7BZ,EAAMkB,KAAK,CACTP,KACAC,QACAC,iBACAC,eACAC,YACAC,aACAC,eACAV,eAK8CE,M,4KC5BzCU,EAAb,kDAIE,WAAYV,GAAqE,IAAD,8BAC9E,cAAMA,IACD3B,MAAQ,CACXP,MAAO,MAHqE,EAJlF,0CAeE,WAAU,IAAD,EAC8B6C,KAAKX,MAAlCY,EADD,EACCA,eAAgBC,EADjB,EACiBA,SAChB/C,EAAU6C,KAAKtC,MAAfP,MACR,OAAIA,EACK8C,EAAe,CAAE9C,UAEnB+C,KArBX,uCAYE,SAAgC/C,GAC9B,MAAO,CAAEA,aAbb,GAAmCgD,IAAMC,W,QCCnCC,EAAmBF,IAAMG,MAAK,kBAAM,8DACpCC,EAAqBJ,IAAMG,MAAK,kBAAM,uDAa7BE,MAXf,WAAgB,IACN1D,EAASC,cAATD,KACR,OACE,yBAAK2D,UAAU,OACb,kBAAC,EAAD,CAAeR,eAAgBS,KAC7B,kBAAC,IAAMC,SAAP,CAAgBC,SAAU,kBAAC,IAAD,OAAsB9D,EAAO,kBAACuD,EAAD,MAAuB,kBAACE,EAAD,UCRvEM,EAZS,SAACC,GACnBA,GAAeA,aAAuBC,UACxC,8BAAqB5E,MAAK,YAAkD,IAA/C6E,EAA8C,EAA9CA,OAAQC,EAAsC,EAAtCA,OAAQC,EAA8B,EAA9BA,OAAQC,EAAsB,EAAtBA,OAAQC,EAAc,EAAdA,QAC3DJ,EAAOF,GACPG,EAAOH,GACPI,EAAOJ,GACPK,EAAOL,GACPM,EAAQN,O,2BCIDO,EAAgB,SAAC,GAA2C,IAAzCnB,EAAwC,EAAxCA,SACxBoB,EAAc,IAAIC,cAAY,CAClCC,eAAgB,CACdC,QAAS,CACPC,sBAAsB,MAI5B,OACE,kBAAC,sBAAD,CAAqBC,OAAQL,GAC3B,kBAAC,IAAD,KACE,kBAAC,IAAD,KAAepB,M,gBCNvB0B,aAAW,WACTC,IAASC,OACP,kBAAC,IAAMC,WAAP,KACE,kBAAC,IAAD,CAAUxC,GAAI,WAAYH,OAAQ,CAAC,UACjC,kBAAC,EAAD,KACE,kBAAC,IAAD,MACA,kBAAC,EAAD,SAINpF,SAASgI,eAAe,YAO5BnB,K,qMCvBM7F,EAASC,qBACTgH,EAAkB,0BAEXC,EAAW,kBAAM/H,OAAOgI,aAAaC,QAAQH,IAE7CI,EAAqB,SAAC,GAA8B,IAA5BvF,EAA2B,EAA3BA,KAEnC,OADA3C,OAAOgI,aAAaG,QAAQL,EAAiBnF,EAAKxB,OAAS,IACpDwB,GAIIyF,EAAQ,SAAClH,GACpB,OAAOa,MAAM,GAAD,OAAIlB,EAAJ,UAAoB,CAC9BU,OAAQ,OACRH,QAAS,CACP,eAAgB,oBAElBS,KAAMC,KAAKH,UAAUT,KACpBc,KANI,uCAMC,WAAOC,GAAP,SAAAhB,EAAA,0DACFgB,EAASQ,GADP,4BAEGyF,EAFH,SAE4BjG,EAASO,OAFrC,+EAIGH,QAJH,UAIwBJ,EAASO,OAJjC,kDAIWF,OAJX,6DAND,wDAgBI+F,EAAW,SAACnH,GACvB,OAAOa,MAAM,GAAD,OAAIlB,EAAJ,aAAuB,CACjCU,OAAQ,OACRH,QAAS,CACP,eAAgB,oBAElBS,KAAMC,KAAKH,UAAUT,KACpBc,KANI,uCAMC,WAAOC,GAAP,SAAAhB,EAAA,0DACFgB,EAASQ,GADP,4BAEGyF,EAFH,SAE4BjG,EAASO,OAFrC,+EAIGH,QAJH,UAIwBJ,EAASO,OAJjC,kDAIWF,OAJX,6DAND,wDAgBIgG,EAAM,uCAAG,sBAAArH,EAAA,+EAAYjB,OAAOgI,aAAaO,WAAWT,IAA3C,2CAAH,sD,8TC5CNU,EAAkBC,YAAOC,IAAPD,CAAH,2CAIfE,EAAkB,kBAC7B,kBAACC,EAAD,KACE,kBAAC,IAAD,CAAMC,KAAM,YAIHtC,EAAwB,SAAC,GAAD,IAAGvD,EAAH,EAAGA,MAAH,OACnC,kBAAC4F,EAAD,KACE,kBAAC,IAAD,MACA,kBAACE,EAAD,CAAU9F,MAAOA,MAOR8F,EAAW,SAAC,GAAmC,IAF3CpK,EAEUsE,EAAgC,EAAhCA,MACzB,OAHc,QAACtE,EAGHsE,SAHE,IAAgCtE,OAAhC,EAAgCA,EAAO6D,SAI5C,kBAAC,IAAWwG,KAAZ,CAAiBC,KAAM,UAAWhG,EAAMT,SAE1C,MAGHqG,EAAWH,IAAOQ,IAAV,oHAODC,EAAMT,IAAOQ,IAAV,6NAOK,SAAA/D,GAAK,OAAKA,EAAMiE,QAAU,qBAAkBxK,KAC9C,SAAAuG,GAAK,OAAIA,EAAMkE,aAAe,SAI7B,SAAAlE,GAAK,MAA0B,kBAAdA,EAAMmE,IAAmBnE,EAAMmE,IAAM,MAAQnE,EAAMmE,IAAM,YAAS1K,KAI1F2K,EAAkBb,IAAOQ,IAAV,8G,qMClCtBM,EAAa,uCAAG,gCAAAtI,EAAA,yDAChB0B,EAAO,OACLxB,EAAQgB,OAFM,gCAICpB,YAAK,KAAM,CAAEI,UAJd,OAIZD,EAJY,OAKlByB,EAAOzB,EAAKyB,KALM,gCAObA,GAPa,2CAAH,qDAUb6G,EAAcxD,IAAMyD,mBAA0C9K,GACpE6K,EAAYE,YAAc,cAEnB,IAAMC,EAAe,SAAC,GAA2C,IAAzC5D,EAAwC,EAAxCA,SAAwC,EACa5C,cAApER,EADuD,EAC7DzB,KAAYmD,EADiD,EACjDA,QAASC,EADwC,EACxCA,UAAWC,EAD6B,EAC7BA,QAASvB,EADoB,EACpBA,MAAgB4G,EADI,EACb9F,QAAkBE,EADL,EACKA,IACpEmD,EAAc0C,2BAiBpB,OAPAhL,YACEgE,uBAAY,WACVmB,EAAIuF,OAEH,KAGDlF,GAAWC,EAAkB,kBAAC,IAAD,MAC7BC,EAAgB,kBAAC,IAAD,CAAuBvB,MAAOA,IAE3C,kBAACwG,EAAYM,SAAb,CAAsB/D,SAAUA,EAAUrH,MAAO,CAAEiE,OAAMyF,MAlBlD,SAAC2B,GAAD,OAAoB5H,IAAW4H,GAAM/H,KAAK4H,IAkBevB,SAjBtD,SAAC0B,GAAD,OAAoB5H,IAAc4H,GAAM/H,KAAK4H,IAiBmBtB,OAhBlE,kBACbnG,MAAcH,MAAK,WACjB4H,EAAQ,MACRzC,EAAY6C,gBAgBLpH,EAAU,WACrB,IAAMqH,EAAUjE,IAAMkE,WAAWV,GACjC,IAAKS,EACH,MAAM,IAAI9F,MAAM,2DAElB,OAAO8F,K","file":"static/js/main.301ef559.chunk.js","sourcesContent":["/*\r\n * @Description:\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-04 16:14:01\r\n * @LastEditTime: 2021-11-18 15:58:05\r\n * @LastEditors: 杨超\r\n */\r\nimport { useEffect, useRef, useState } from 'react'\r\n\r\nexport const isFalsy = (value: unknown) => (value === 0 ? false : !value)\r\nexport const isVoid = (value: unknown) => value === undefined || value === null || value === '' // 解决值为undefined or null or ''的情况\r\n\r\nexport const cleanObject = (object?: { [key: string]: unknown }) => {\r\n  if (!object) return {}\r\n  const result = { ...object }\r\n  Object.keys(result).forEach((key) => {\r\n    const value = result[key]\r\n    if (isVoid(value)) {\r\n      delete result[key]\r\n    }\r\n  })\r\n  return result\r\n}\r\n\r\nexport const useMount = (callback: () => void) => {\r\n  useEffect(() => {\r\n    callback()\r\n  }, [callback])\r\n}\r\n\r\nexport const useDebounce = <V>(value: V, delay?: number) => {\r\n  const [debouncedValue, setDebouncedValue] = useState<V>(value)\r\n\r\n  useEffect(() => {\r\n    const timeout = setTimeout(() => {\r\n      setDebouncedValue(value)\r\n    }, delay)\r\n    return () => clearTimeout(timeout)\r\n  }, [value, delay])\r\n\r\n  return debouncedValue\r\n}\r\n\r\nexport const useArray = <T>(initialArray: T[]) => {\r\n  const [value, setValue] = useState(initialArray)\r\n  return {\r\n    value,\r\n    setValue,\r\n    add: (item: T) => setValue([...value, item]),\r\n    clear: () => setValue([]),\r\n    removeIndex: (index: number) => {\r\n      const copy = [...value]\r\n      copy.splice(index, 1)\r\n      setValue(copy)\r\n    },\r\n  }\r\n}\r\n\r\n// 可用 react-helmet 组件修改页面标题\r\nexport const useDocumentTitle = (title: string, keepOnUnment: boolean = true) => {\r\n  const oldTitle = useRef(document.title).current\r\n\r\n  useEffect(() => {\r\n    document.title = title\r\n  }, [title])\r\n\r\n  useEffect(() => {\r\n    return () => {\r\n      if (!keepOnUnment) {\r\n        document.title = oldTitle\r\n      }\r\n    }\r\n  }, [keepOnUnment, oldTitle])\r\n}\r\n\r\nexport const resetRoute = () => (window.location.href = window.location.origin)\r\n\r\n/**\r\n * 传入一个对象，和键集合，返回对应的对象中的键值对\r\n * @param obj\r\n * @param keys\r\n */\r\nexport const subset = <O extends { [key in string]: unknown }, K extends keyof O>(obj: O, keys: K[]) => {\r\n  const filteredEntries = Object.entries(obj).filter(([key]) => keys.includes(key as K))\r\n  return Object.fromEntries(filteredEntries) as Pick<O, K>\r\n}\r\n\r\n/**\r\n * 返回组件的挂载状态，如果还没有挂载或者已经卸载，返回false；反之，返回true\r\n */\r\nexport const useMountedRef = () => {\r\n  const mountedRef = useRef(false)\r\n  useEffect(() => {\r\n    mountedRef.current = true\r\n    return () => {\r\n      mountedRef.current = false\r\n    }\r\n  })\r\n  return mountedRef\r\n}\r\n","/*\r\n * @Description: fetch请求封装\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-10 11:26:31\r\n * @LastEditTime: 2021-11-18 15:45:41\r\n * @LastEditors: 杨超\r\n */\r\n\r\nimport qs from 'qs'\r\nimport * as auth from 'auth-provider'\r\nimport { useAuth } from '../context/auth-context'\r\nimport { useCallback } from 'react'\r\n\r\ninterface Config extends RequestInit {\r\n  data?: object\r\n  token?: string\r\n}\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL\r\n\r\nexport const http = async (endpoint: string, { data, token, headers, ...customConfig }: Config = {}) => {\r\n  const config = {\r\n    method: 'GET',\r\n    headers: {\r\n      Authorization: token ? `Bearer ${token}` : '',\r\n      'Content-Type': data ? 'application/json' : '',\r\n    },\r\n    ...customConfig,\r\n  }\r\n\r\n  if (config.method.toUpperCase() === 'GET') {\r\n    endpoint += qs.stringify(data ?? {}, { addQueryPrefix: true }) // addQueryPrefix 预添加'?'号\r\n  } else {\r\n    config.body = JSON.stringify(data)\r\n  }\r\n\r\n  // axios 和 fetch 的表现不一样，axios可以直接在返回状态不为2xx的时候抛出异常\r\n  return window.fetch(`${apiUrl}/${endpoint}`, config).then(async response => {\r\n    if (response.status === 401) {\r\n      await auth.logout()\r\n      window.location.reload()\r\n      return Promise.reject({ message: '请重新登录' })\r\n    }\r\n    const data = await response.json()\r\n    if (response.ok) {\r\n      return data\r\n    } else {\r\n      return Promise.reject(data)\r\n    }\r\n  })\r\n}\r\n\r\nexport const useHttp = () => {\r\n  const { user } = useAuth()\r\n  // TS : Utility Types\r\n  return useCallback(\r\n    (...[endpoint, config]: Parameters<typeof http>) => http(endpoint, { ...config, token: user?.token }),\r\n    [user?.token]\r\n  )\r\n}\r\n","/*\r\n * @Description: useAsync（处理请求状态）\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-11 16:59:21\r\n * @LastEditTime: 2021-11-30 15:34:12\r\n * @LastEditors: 杨超\r\n */\r\nimport { useCallback, useState, useReducer } from 'react'\r\nimport { useMountedRef } from 'utils'\r\n\r\ninterface State<D> {\r\n  stat: 'idle' | 'loading' | 'error' | 'success'\r\n  data: D | null\r\n  error: Error | null\r\n}\r\n\r\nconst defultInitialState: State<null> = {\r\n  stat: 'idle',\r\n  data: null,\r\n  error: null,\r\n}\r\n\r\nconst defaultConfig = {\r\n  throwOnError: false,\r\n}\r\n\r\nconst useSafeDispatch = <T>(dispatch: (...args: T[]) => void) => {\r\n  const mountedRef = useMountedRef()\r\n  return useCallback((...args: T[]) => (mountedRef.current ? dispatch(...args) : void 0), [dispatch, mountedRef])\r\n}\r\n\r\nexport const useAsync = <D>(initialState?: State<D>, initiaConfig?: typeof defaultConfig) => {\r\n  const config = { ...defaultConfig, ...initiaConfig }\r\n  const [state, dispatch] = useReducer((state: State<D>, action: Partial<State<D>>) => ({ ...state, ...action }), {\r\n    ...defultInitialState,\r\n    ...initialState,\r\n  })\r\n  const safeDispatch = useSafeDispatch(dispatch)\r\n  // useState直接传入函数的含义是：惰性初始化；所以，要用useState保存函数，不能直接传入函数。 https://codesandbox.io/s/blissful-water-230u4?file=/src/App.js\r\n  const [retry, setRetry] = useState(() => () => {})\r\n\r\n  const setData = useCallback(\r\n    (data: D) =>\r\n      safeDispatch({\r\n        data,\r\n        stat: 'success',\r\n        error: null,\r\n      }),\r\n    [safeDispatch]\r\n  )\r\n\r\n  const setError = useCallback(\r\n    (error: Error) =>\r\n      safeDispatch({\r\n        error,\r\n        stat: 'error',\r\n        data: null,\r\n      }),\r\n    [safeDispatch]\r\n  )\r\n\r\n  const run = useCallback(\r\n    (promise: Promise<D>, runConfig?: { retry: () => Promise<D> }) => {\r\n      if (!promise || !promise.then) {\r\n        throw new Error('请传入 Promise 类型数据')\r\n      }\r\n      setRetry(() => () => {\r\n        if (runConfig?.retry) {\r\n          run(runConfig?.retry(), runConfig)\r\n        }\r\n      })\r\n      safeDispatch({ stat: 'loading' })\r\n      return promise\r\n        .then(data => {\r\n          setData(data)\r\n          return data\r\n        })\r\n        .catch(error => {\r\n          // catch 会消化异常，如果不主动抛出，外面是接收不到异常的\r\n          setError(error)\r\n          if (config.throwOnError) return Promise.reject(error)\r\n          return error\r\n        })\r\n    },\r\n    [config.throwOnError, setData, setError, safeDispatch]\r\n  )\r\n  return {\r\n    isiIdle: state.stat === 'idle',\r\n    isLoading: state.stat === 'loading',\r\n    isError: state.stat === 'error',\r\n    isSuccess: state.stat === 'success',\r\n    run,\r\n    retry,\r\n    setData,\r\n    setError,\r\n    ...state,\r\n  }\r\n}\r\n","import React, { ProfilerOnRenderCallback, ProfilerProps } from 'react'\r\n\r\ntype Props = { metadata?: any; phases?: ('mount' | 'update')[] } & Omit<ProfilerProps, 'onRender'>\r\n\r\nlet queue: unknown[] = []\r\n\r\nconst sendProfileQueue = () => {\r\n  if (!queue.length) {\r\n    return\r\n  }\r\n  const queueToSend = [...queue]\r\n  queue = []\r\n  console.log('性能信息', queueToSend)\r\n}\r\n\r\nsetInterval(sendProfileQueue, 5000)\r\n\r\nexport const Profiler = ({ metadata, phases, ...props }: Props) => {\r\n  const reportProfile: ProfilerOnRenderCallback = (\r\n    id,\r\n    phase,\r\n    actualDuration,\r\n    baseDuration,\r\n    startTime,\r\n    commitTime,\r\n    interactions\r\n  ) => {\r\n    if (!phases || phases.includes(phase)) {\r\n      queue.push({\r\n        id,\r\n        phase,\r\n        actualDuration,\r\n        baseDuration,\r\n        startTime,\r\n        commitTime,\r\n        interactions,\r\n        metadata,\r\n      })\r\n    }\r\n  }\r\n\r\n  return <React.Profiler onRender={reportProfile} {...props} />\r\n}\r\n","/*\r\n * @Description: 错误边界组件\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-15 11:22:25\r\n * @LastEditTime: 2021-11-15 11:41:33\r\n * @LastEditors: 杨超（yangchao）\r\n */\r\nimport React from 'react'\r\n\r\ntype FallbackRender = (props: { error: Error | null }) => React.ReactElement\r\n\r\n// https://github.com/bvaughn/react-error-boundary (github错误边界组件)\r\nexport class ErrorBoundary extends React.Component<\r\n  React.PropsWithChildren<{ fallbackRender: FallbackRender }>,\r\n  { error: Error | null }\r\n> {\r\n  constructor(props: React.PropsWithChildren<{ fallbackRender: FallbackRender }>) {\r\n    super(props)\r\n    this.state = {\r\n      error: null,\r\n    }\r\n  }\r\n\r\n  // 当子组件抛出异常，这里会接收异常\r\n  static getDerivedStateFromError(error: Error) {\r\n    return { error }\r\n  }\r\n  render() {\r\n    const { fallbackRender, children } = this.props\r\n    const { error } = this.state\r\n    if (error) {\r\n      return fallbackRender({ error })\r\n    }\r\n    return children\r\n  }\r\n}\r\n","/*\r\n * @Description: app页面\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-04 16:14:01\r\n * @LastEditTime: 2021-11-15 11:45:59\r\n * @LastEditors: 杨超（yangchao）\r\n */\r\nimport React from 'react'\r\nimport './App.css'\r\nimport { useAuth } from 'context/auth-context'\r\nimport { ErrorBoundary } from 'components/error-boundary'\r\nimport { FullPageErrorFallback, FullPageLoading } from 'components/lib'\r\n\r\nconst AuthenticatedApp = React.lazy(() => import('authenticated-app'))\r\nconst UnauthenticatedApp = React.lazy(() => import('unauthenticated-app'))\r\n\r\nfunction App() {\r\n  const { user } = useAuth()\r\n  return (\r\n    <div className=\"App\">\r\n      <ErrorBoundary fallbackRender={FullPageErrorFallback}>\r\n        <React.Suspense fallback={<FullPageLoading />}>{user ? <AuthenticatedApp /> : <UnauthenticatedApp />}</React.Suspense>\r\n      </ErrorBoundary>\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default App\r\n","import { ReportHandler } from 'web-vitals';\r\n\r\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\r\n  if (onPerfEntry && onPerfEntry instanceof Function) {\r\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\r\n      getCLS(onPerfEntry);\r\n      getFID(onPerfEntry);\r\n      getFCP(onPerfEntry);\r\n      getLCP(onPerfEntry);\r\n      getTTFB(onPerfEntry);\r\n    });\r\n  }\r\n};\r\n\r\nexport default reportWebVitals;\r\n","/*\r\n * @Description:\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-04 16:14:01\r\n * @LastEditTime: 2022-04-15 16:57:21\r\n * @LastEditors: 杨超\r\n */\r\nimport React, { ReactNode } from 'react'\r\nimport { AuthProvider } from 'context/auth-context'\r\nimport { QueryClient, QueryClientProvider } from 'react-query'\r\nimport { BrowserRouter as Router } from 'react-router-dom'\r\n\r\nexport const AuthProviders = ({ children }: { children: ReactNode }) => {\r\n  const queryClient = new QueryClient({\r\n    defaultOptions: {\r\n      queries: {\r\n        refetchOnWindowFocus: false,\r\n      },\r\n    },\r\n  })\r\n  return (\r\n    <QueryClientProvider client={queryClient}>\r\n      <Router>\r\n        <AuthProvider>{children}</AuthProvider>\r\n      </Router>\r\n    </QueryClientProvider>\r\n  )\r\n}\r\n","/*\r\n * @Description: 入口文件\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-04 16:14:01\r\n * @LastEditTime: 2021-11-11 15:33:01\r\n * @LastEditors: 杨超（yangchao）\r\n */\r\nimport React from 'react'\r\nimport ReactDOM from 'react-dom'\r\nimport App from './App'\r\nimport reportWebVitals from './reportWebVitals'\r\nimport { DevTools, loadServer } from 'jira-dev-tool'\r\nimport { AuthProviders } from 'context'\r\nimport { Profiler } from 'components/profiler'\r\n// 务必在jira-dev-tool后面引入\r\nimport 'antd/dist/antd.less'\r\n\r\nloadServer(() => {\r\n  ReactDOM.render(\r\n    <React.StrictMode>\r\n      <Profiler id={'Root App'} phases={['mount']}>\r\n        <AuthProviders>\r\n          <DevTools />\r\n          <App />\r\n        </AuthProviders>\r\n      </Profiler>\r\n    </React.StrictMode>,\r\n    document.getElementById('root')\r\n  )\r\n})\r\n\r\n// If you want to start measuring performance in your app, pass a function\r\n// to log results (for example: reportWebVitals(console.log))\r\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\r\nreportWebVitals()\r\n","/*\r\n * @Description: 处理登录接口\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-04 16:14:01\r\n * @LastEditTime: 2021-11-12 14:33:34\r\n * @LastEditors: 杨超（yangchao）\r\n */\r\n// 在真实环境中，如果使用firebase这种第三方auth服务的话，本文件不需要开发者开发\r\n\r\nimport { User } from 'types/user'\r\n\r\nconst apiUrl = process.env.REACT_APP_API_URL\r\nconst localStorageKey = '__auth_provider_token__'\r\n\r\nexport const getToken = () => window.localStorage.getItem(localStorageKey)\r\n\r\nexport const handleUserResponse = ({ user }: { user: User }) => {\r\n  window.localStorage.setItem(localStorageKey, user.token || '')\r\n  return user\r\n}\r\n\r\n// 登录\r\nexport const login = (data: { username: string; password: string }) => {\r\n  return fetch(`${apiUrl}/login`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify(data),\r\n  }).then(async (response: Response) => {\r\n    if (response.ok) {\r\n      return handleUserResponse(await response.json())\r\n    } else {\r\n      return Promise.reject(await response.json())\r\n    }\r\n  })\r\n}\r\n\r\n// 注册\r\nexport const register = (data: { username: string; password: string }) => {\r\n  return fetch(`${apiUrl}/register`, {\r\n    method: 'POST',\r\n    headers: {\r\n      'Content-Type': 'application/json',\r\n    },\r\n    body: JSON.stringify(data),\r\n  }).then(async (response: Response) => {\r\n    if (response.ok) {\r\n      return handleUserResponse(await response.json())\r\n    } else {\r\n      return Promise.reject(await response.json())\r\n    }\r\n  })\r\n}\r\n\r\n// 登出\r\nexport const logout = async () => window.localStorage.removeItem(localStorageKey)\r\n","/*\r\n * @Description: 封装Row样式组件\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-11 13:11:41\r\n * @LastEditTime: 2022-04-16 13:45:41\r\n * @LastEditors: 杨超\r\n */\r\nimport React from 'react'\r\nimport styled from '@emotion/styled'\r\nimport { Button, Spin, Typography } from 'antd'\r\nimport { DevTools } from 'jira-dev-tool'\r\n\r\nexport const ButtonNoPadding = styled(Button)`\r\n  padding: 0;\r\n`\r\n\r\nexport const FullPageLoading = () => (\r\n  <FullPage>\r\n    <Spin size={'large'} />\r\n  </FullPage>\r\n)\r\n\r\nexport const FullPageErrorFallback = ({ error }: { error: Error | null }) => (\r\n  <FullPage>\r\n    <DevTools />\r\n    <ErrorBox error={error} />\r\n  </FullPage>\r\n)\r\n\r\n// 类型守卫\r\nconst isError = (value: any): value is Error => value?.message\r\n\r\nexport const ErrorBox = ({ error }: { error: unknown }) => {\r\n  if (isError(error)) {\r\n    return <Typography.Text type={'danger'}>{error.message}</Typography.Text>\r\n  }\r\n  return null\r\n}\r\n\r\nconst FullPage = styled.div`\r\n  height: 100vh;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n`\r\n\r\nexport const Row = styled.div<{\r\n  gap?: number | boolean\r\n  between?: boolean\r\n  marginBottom?: number\r\n}>`\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: ${props => (props.between ? 'space-between' : undefined)};\r\n  margin-bottom: ${props => props.marginBottom + 'rem'};\r\n  > * {\r\n    margin-top: 0 !important;\r\n    margin-bottom: 0 !important;\r\n    margin-right: ${props => (typeof props.gap === 'number' ? props.gap + 'rem' : props.gap ? '2rem' : undefined)};\r\n  }\r\n`\r\n\r\nexport const ScreenContainer = styled.div`\r\n  padding: 3.2rem;\r\n  width: 100%;\r\n  display: flex;\r\n  flex-direction: column;\r\n`\r\n","/*\r\n * @Description: 登录逻辑接口\r\n * @Author: 杨超（yangchao）\r\n * @Email: Angry_bull@126.com\r\n * @Date: 2021-11-04 16:14:01\r\n * @LastEditTime: 2022-04-15 20:34:22\r\n * @LastEditors: 杨超\r\n */\r\nimport React, { ReactNode, useCallback } from 'react'\r\nimport * as auth from 'auth-provider'\r\nimport { User } from 'types/user'\r\nimport { useMount } from 'utils'\r\nimport { http } from 'utils/http'\r\nimport { useAsync } from 'utils/use-async'\r\nimport { FullPageErrorFallback, FullPageLoading } from 'components/lib'\r\nimport { useQueryClient } from 'react-query'\r\n\r\ninterface AuthForm {\r\n  username: string\r\n  password: string\r\n}\r\n\r\ninterface createContextT {\r\n  user: User | null\r\n  login: (form: AuthForm) => Promise<void>\r\n  register: (form: AuthForm) => Promise<void>\r\n  logout: () => Promise<void>\r\n}\r\n\r\nconst bootstrapUser = async () => {\r\n  let user = null\r\n  const token = auth.getToken()\r\n  if (token) {\r\n    const data = await http('me', { token })\r\n    user = data.user\r\n  }\r\n  return user\r\n}\r\n\r\nconst AuthContext = React.createContext<createContextT | undefined>(undefined)\r\nAuthContext.displayName = 'AuthContext'\r\n\r\nexport const AuthProvider = ({ children }: { children: ReactNode }) => {\r\n  const { data: user, isiIdle, isLoading, isError, error, setData: setUser, run } = useAsync<User | null>()\r\n  const queryClient = useQueryClient()\r\n\r\n  const login = (form: AuthForm) => auth.login(form).then(setUser)\r\n  const register = (form: AuthForm) => auth.register(form).then(setUser)\r\n  const logout = () =>\r\n    auth.logout().then(() => {\r\n      setUser(null)\r\n      queryClient.clear()\r\n    })\r\n\r\n  useMount(\r\n    useCallback(() => {\r\n      run(bootstrapUser())\r\n      // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, [])\r\n  )\r\n\r\n  if (isiIdle || isLoading) return <FullPageLoading />\r\n  if (isError) return <FullPageErrorFallback error={error} />\r\n\r\n  return <AuthContext.Provider children={children} value={{ user, login, register, logout }} />\r\n}\r\n\r\nexport const useAuth = () => {\r\n  const context = React.useContext(AuthContext)\r\n  if (!context) {\r\n    throw new Error('useAuth必须在AuthProvider中使用')\r\n  }\r\n  return context\r\n}\r\n"],"sourceRoot":""}